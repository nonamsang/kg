<!--<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Little Forest</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/emission.css">
<link rel="stylesheet" href="/css/mainpagestyle.css">
<link rel="stylesheet" href="/css/emission1.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<style>
.sidebar {
  width: 220px;
  background: #e6f0ea;
  padding: 10px;
  box-sizing: border-box;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

.sidebar button {
  width: 100%;
  padding: 12px 0;
  margin-bottom: 12px;
  border: none;
  border-radius: 8px;
  background: #ffffff;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

.sidebar button:hover {
  background: #cde6d0;
  transform: translateY(-2px);
}

.sidebar button.active {
  background: #4caf50;
  color: #fff;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}
  .main { flex: 1; padding: 20px; overflow-y: auto; }
  .content-section { display: none; } /* ê¸°ë³¸ ìˆ¨ê¹€ */
  .content-section.active { display: block; } /* ì„ íƒëœ í™”ë©´ë§Œ í‘œì‹œ */
</style>
</head>
<body>

 í—¤ë”: í•œ ë²ˆë§Œ ìµœìƒë‹¨ì— 
<div th:replace="fragments/header :: header"></div>

 ì‚¬ì´ë“œë°” + ë©”ì¸ ì˜ì—­ 
<div style="display:flex; min-height: calc(100vh - 160px);"> 
   ì‚¬ì´ë“œë°” 
  <div class="sidebar" style="width:200px; background:#f0f4f8; box-sizing:border-box;">
    <button id="btn-month" class="active">ì›” íƒ„ì†Œ ì†Œë¹„ëŸ‰</button>
    <button id="btn-year">ë…„ íƒ„ì†Œ ì†Œë¹„ëŸ‰</button>
  </div>

   ë©”ì¸ ì˜ì—­ 
  <div class="main" style="flex:1; overflow:auto;">
     ì›” íƒ„ì†Œ ì†Œë¹„ëŸ‰ ì˜ì—­ 
    <div id="month-section" class="content-section active">
      <div class="wrap" th:with="uid=${user_id}, y=${year}, m=${month}">
        <div class="title">ë‚˜ì˜ ì›”ë³„ íƒ„ì†Œ ë°°ì¶œëŸ‰</div>
        <div class="toolbar">
          <div class="select">
          <button class="arrow" id="prevBtn">â—€</button>
            <span>ğŸ“…</span>
            <select id="monthSelect"></select>
            <select id="yearSelect"></select>
          <button class="arrow" id="nextBtn">â–¶</button>
          </div>
        </div>

        <div class="kpi">
          <div class="label">EMISSIONS</div>
          <div class="hint" title="ì„ íƒí•œ ì›”ì˜ ì´ ë°°ì¶œëŸ‰(kg)">â“˜</div>
        </div>
        <div class="big" id="bigNumber">-- KG</div>

        <div class="charts">
          <div class="chartbox">
            <canvas id="emissionChart"></canvas>
          </div>
          <div class="chartbox">
            <canvas id="emissionDonut"></canvas>
          </div>
        </div>
      </div>
    </div>

     ë…„ íƒ„ì†Œ ì†Œë¹„ëŸ‰ ì˜ì—­ 
    <div id="year-section" class="content-section">
      <div id="calendar-controls" style="max-width: 800px; margin: 30px auto; display: flex; justify-content: center; gap: 20px; align-items: center;">
        <select id="year-select" aria-label="ë…„ë„ ì„ íƒ"></select>
        <select id="month-select" aria-label="ì›” ì„ íƒ"></select>
      </div>
      <div id="calendar-container">
        <div id="calendar"></div>
      </div>
    </div>
  </div>
</div>

 í‘¸í„°: í•œ ë²ˆë§Œ ìµœí•˜ë‹¨ì— 
<div th:replace="fragments/footer :: footer"></div>


<script src="/js/emission1.js"></script>
<script>
  // ì‚¬ì´ë“œë°” í† ê¸€
  const btnMonth = document.getElementById('btn-month');
  const btnYear  = document.getElementById('btn-year');
  const monthSection = document.getElementById('month-section');
  const yearSection  = document.getElementById('year-section');

  btnMonth.addEventListener('click', () => {
    btnMonth.classList.add('active');
    btnYear.classList.remove('active');
    monthSection.classList.add('active');
    yearSection.classList.remove('active');
  });

  btnYear.addEventListener('click', () => {
    btnYear.classList.add('active');
    btnMonth.classList.remove('active');
    yearSection.classList.add('active');
    monthSection.classList.remove('active');
  });
</script>

	<script>
	(function(){
		  const uid   = /*[[${user_id}]]*/ 1;
		  let   year  = /*[[${year}]]*/    new Date().getFullYear();
		  let   month = /*[[${month}]]*/   new Date().getMonth()+1;
		
		  const monthSelect = document.getElementById('monthSelect');
		  const yearSelect  = document.getElementById('yearSelect');
		  const prevBtn = document.getElementById('prevBtn');
		  const nextBtn = document.getElementById('nextBtn');
		  const bigNumber = document.getElementById('bigNumber');
		
		  // ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
		  const monthNames = ['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
		  monthNames.forEach((n,i)=>{ const o=document.createElement('option'); o.value=i+1;o.textContent=n; monthSelect.appendChild(o); });
		  const curY = new Date().getFullYear();
		  for(let y=curY-3; y<=curY+1; y++){ const o=document.createElement('option'); o.value=y; o.textContent=y; yearSelect.appendChild(o); }
		
		// ë„ë„›ê³¼ ë™ì¼í•œ íŒ”ë ˆíŠ¸
		  const COLOR_SELECTED = '#ff6b6b';
		  const COLOR_DEFAULT  = '#dbe4f3';

		  // ë§‰ëŒ€ì°¨íŠ¸ìš©: ì„ íƒ ì›”ë§Œ ë¹¨ê°„ìƒ‰
		  function barColors(selectedMonth){
		    return monthNames.map((_, i) =>
		      i === (selectedMonth - 1) ? COLOR_SELECTED : COLOR_DEFAULT
		    );
		  }
		  
		  // ì¤‘ì•™ í…ìŠ¤íŠ¸ í”ŒëŸ¬ê·¸ì¸ (Chart.js v4)
		  const centerTextPlugin = {
		    id: 'centerText',
		    beforeDraw(chart, args, opts){
		      if(!opts) return;
		      const {ctx, chartArea:{left, right, top, bottom, width, height}} = chart;
		      const x = left + width/2;
		      const y = top + height/2;
		      ctx.save();
		      ctx.textAlign = 'center';
		      ctx.textBaseline = 'middle';
		      ctx.fillStyle = '#9aa2ad';
		      ctx.font = '700 14px system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif';
		      if(opts.line1) ctx.fillText(opts.line1, x, y-12);
		      ctx.fillStyle = '#ff6b6b';
		      ctx.font = '900 22px system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif';
		      if(opts.line2) ctx.fillText(opts.line2, x, y+12);
		      ctx.restore();
		    }
		  };
		
		  // ë§‰ëŒ€ ì°¨íŠ¸
		  const barChart = new Chart(document.getElementById('emissionChart'), {
		    type:'bar',
		    data:{ 
		    	labels: monthNames, 
		    	datasets:[{ 
		    		data: new Array(12).fill(0),
		    		backgroundColor: barColors(month),
		    		borderRadius: 8, 
		    		borderSkipped:false }] },
		    options:{
		      responsive:true, maintainAspectRatio:false,
		      plugins:{ legend:{display:false}, tooltip:{callbacks:{label:c=>`${c.raw.toLocaleString()} kg`}} },
		      scales:{
		        x:{ grid:{display:false}, ticks:{font:{weight:'700'}} },
		        y:{ beginAtZero:true, grid:{borderDash:[6,6]}, ticks:{ callback:v=>v.toLocaleString() } }
		      }
		    }
		  });
		
		  // ë„ë„› ì°¨íŠ¸
		  const donutCtx = document.getElementById('emissionDonut');
		  const donutChart = new Chart(donutCtx, {
		    type:'doughnut',
		    data:{ labels: monthNames, datasets:[{ data: new Array(12).fill(0), borderWidth:0, hoverOffset:6, backgroundColor:[] }] },
		    options:{
		      responsive:true, maintainAspectRatio:false, cutout:'65%',
		      plugins:{
		        legend:{ position:'bottom' },
		        tooltip:{ callbacks:{ 
		          label:(c)=>{
		            const v = c.raw || 0;
		            const total = (donutChart.data.datasets[0].data || []).reduce((a,b)=>a+(b||0),0) || 1;
		            const pct = (v*100/total).toFixed(1);
		            return `${c.label}: ${v.toLocaleString()} kg (${pct}%)`;
		          }}},
		        centerText:{ line1:'', line2:'' } // ë™ì ìœ¼ë¡œ ì±„ì›€
		      }
		    },
		    plugins:[centerTextPlugin]
		  });
		
		  function setSelectors(y,m){ yearSelect.value=y; monthSelect.value=m; }
		
		  // ì„ íƒ ì›” ê°•ì¡°ìƒ‰ ë°°ì—´
		  function donutColors(selectedMonth){
		    return monthNames.map((_,i)=> i === (selectedMonth-1) ? '#ff6b6b' : '#dbe4f3');
		  }
		
		// ì¶”ê°€: ì„ íƒ ì›” ë°”ë€” ë•Œ ë§‰ëŒ€ ìƒ‰ë§Œ ì—…ë°ì´íŠ¸
		  function refreshBarVisuals(){
		    barChart.data.datasets[0].backgroundColor = barColors(month);
		    barChart.update();
		  }
		  
		  // ë„ë„› ì¤‘ì•™ í…ìŠ¤íŠ¸/ìƒ‰ ì—…ë°ì´íŠ¸
		  function refreshDonutVisuals(){
		    const data = donutChart.data.datasets[0].data;
		    const selKg = data[month-1] || 0;
		    donutChart.data.datasets[0].backgroundColor = donutColors(month);
		    donutChart.options.plugins.centerText = {
		      line1: `${month}ì›”`,
		      line2: `${selKg.toLocaleString()} KG`
		    };
		    donutChart.update();
		  }
		
		  async function loadMonthly(y){
		    const r = await fetch(`/api/emission/monthly?user_Id=${uid}&year=${y}`);
		    const arr = await r.json(); // [{month, kg}]
		    const data = new Array(12).fill(0);
		    arr.forEach(it => data[it.month-1] = it.kg || 0);
		
		    // ë§‰ëŒ€ ì°¨íŠ¸ ë°˜ì˜
		    barChart.data.datasets[0].data = data;
		    barChart.data.datasets[0].backgroundColor = barColors(month); //ì„¹ìƒ ì¶”ê°€
		    barChart.update();
		
		    // ë„ë„› ì°¨íŠ¸ ë°˜ì˜
		    donutChart.data.datasets[0].data = data;
		    refreshDonutVisuals();
		    refreshBarVisuals();
		  }
		
		  async function loadSummary(y,m){
		    const r = await fetch(`/api/emission/summary?user_Id=${uid}&year=${y}&month=${m}`);
		    const j = await r.json();
		    bigNumber.textContent = `${(j.totalKg || 0).toLocaleString()} KG`;
		  }
		
		  function step(dir){
		    const d = new Date(year, month-1, 1);
		    d.setMonth(d.getMonth()+dir);
		    year=d.getFullYear(); month=d.getMonth()+1;
		    setSelectors(year, month);
		    loadSummary(year, month);
		    loadMonthly(year);
		  }
		
		  monthSelect.addEventListener('change', ()=>{
		    month=Number(monthSelect.value);
		    loadSummary(year, month);
		    refreshDonutVisuals(); // ì„ íƒ ì›”ë§Œ ë°”ë€ ê²½ìš° ìƒ‰/ì¤‘ì•™í…ìŠ¤íŠ¸ ê°±ì‹ 
		    refreshBarVisuals(); //ë§‰ëŒ€ì°¨íŠ¸ë„!
		  });
		  
		  yearSelect.addEventListener('change', ()=>{
		    year=Number(yearSelect.value);
		    loadMonthly(year);
		    loadSummary(year, month);
		  });
		  
		  prevBtn.addEventListener('click', ()=> step(-1));
		  nextBtn.addEventListener('click', ()=> step(1));
		
		  // ì´ˆê¸° ë¡œë”©
		  setSelectors(year, month);
		  loadMonthly(year);
		  loadSummary(year, month);
		})();
	
	</script>

</body>
</html>
-->


<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Little Forest</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/emission.css">
	<link rel="stylesheet" href="/css/mainpagestyle.css">
	<link rel="stylesheet" href="/css/emission1.css">
	<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
	<style>
		.sidebar {
			width: 220px;
			background: #e6f0ea;
			padding: 10px;
			box-sizing: border-box;
			border-radius: 12px;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
		}

		.sidebar button {
			width: 100%;
			padding: 12px 0;
			margin-bottom: 12px;
			border: none;
			border-radius: 8px;
			background: #ffffff;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.2s ease;
			box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
		}

		.sidebar button:hover {
			background: #cde6d0;
			transform: translateY(-2px);
		}

		.sidebar button.active {
			background: #4caf50;
			color: #fff;
			box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
		}

		.main {
			flex: 1;
			padding: 20px;
			overflow-y: auto;
		}

		.content-section {
			display: none;
		}

		/* ê¸°ë³¸ ìˆ¨ê¹€ */
		.content-section.active {
			display: block;
		}

		/* ì„ íƒëœ í™”ë©´ë§Œ í‘œì‹œ */
	</style>
</head>

<body>

	<!-- í—¤ë”: í•œ ë²ˆë§Œ ìµœìƒë‹¨ì— -->
	<div th:replace="fragments/header :: header"></div>

	<!-- ì‚¬ì´ë“œë°” + ë©”ì¸ ì˜ì—­ -->
	<div style="display:flex; min-height: calc(100vh - 160px);">
		<!-- ì‚¬ì´ë“œë°” -->
		<div class="sidebar" style="width:200px; background:#f0f4f8; box-sizing:border-box;">
			<button id="btn-month" class="active">ì›” íƒ„ì†Œ ì†Œë¹„ëŸ‰</button>
			<button id="btn-year">ë…„ íƒ„ì†Œ ì†Œë¹„ëŸ‰</button>
		</div>

		<!-- ë©”ì¸ ì˜ì—­ -->
		<div class="main" style="flex:1; overflow:auto;">
			<!-- ì›” íƒ„ì†Œ ì†Œë¹„ëŸ‰ ì˜ì—­ -->
			<div id="month-section" class="content-section active">
				<div class="wrap" th:with="uid=${user_id}, y=${year}, m=${month}">
					<div class="title">ë‚˜ì˜ ì›”ë³„ íƒ„ì†Œ ë°°ì¶œëŸ‰</div>
					<div class="toolbar">
						<div class="select">
							<button class="arrow" id="prevBtn">â—€</button>
							<span>ğŸ“…</span>
							<select id="monthSelect"></select>
							<select id="yearSelect"></select>
							<button class="arrow" id="nextBtn">â–¶</button>
						</div>
					</div>

					<div class="kpi">
						<div class="label">EMISSIONS</div>
						<div class="hint" title="ì„ íƒí•œ ì›”ì˜ ì´ ë°°ì¶œëŸ‰(kg)">â“˜</div>
					</div>
					<div class="big" id="bigNumber">-- KG</div>

					<div class="charts">
						<div class="chartbox">
							<canvas id="emissionChart"></canvas>
						</div>
						<div class="chartbox">
							<canvas id="emissionDonut"></canvas>
						</div>
					</div>
				</div>
			</div>

			<!-- ë…„ íƒ„ì†Œ ì†Œë¹„ëŸ‰ ì˜ì—­ -->
			<div id="year-section" class="content-section">
				<div id="calendar-controls"
					style="max-width: 800px; margin: 30px auto; display: flex; justify-content: center; gap: 20px; align-items: center;">
					<select id="year-select" aria-label="ë…„ë„ ì„ íƒ"></select>
					<select id="month-select" aria-label="ì›” ì„ íƒ"></select>
				</div>
				<div id="calendar-container">
					<div id="calendar"></div>
				</div>
			</div>
		</div>
	</div>

	<!-- í‘¸í„°: í•œ ë²ˆë§Œ ìµœí•˜ë‹¨ì— -->
	<div th:replace="fragments/footer :: footer"></div>


	<script src="/js/emission1.js"></script>
	<script>
		// ì‚¬ì´ë“œë°” í† ê¸€
		const btnMonth = document.getElementById('btn-month');
		const btnYear = document.getElementById('btn-year');
		const monthSection = document.getElementById('month-section');
		const yearSection = document.getElementById('year-section');

		btnMonth.addEventListener('click', () => {
			btnMonth.classList.add('active');
			btnYear.classList.remove('active');
			monthSection.classList.add('active');
			yearSection.classList.remove('active');
		});

		btnYear.addEventListener('click', () => {
			btnYear.classList.add('active');
			btnMonth.classList.remove('active');
			yearSection.classList.add('active');
			monthSection.classList.remove('active');
		});
	</script>

	<script>
		(function () {
			const uid = /*[[${user_id}]]*/ 1;
			let year = /*[[${year}]]*/    new Date().getFullYear();
			let month = /*[[${month}]]*/   new Date().getMonth() + 1;

			const monthSelect = document.getElementById('monthSelect');
			const yearSelect = document.getElementById('yearSelect');
			const prevBtn = document.getElementById('prevBtn');
			const nextBtn = document.getElementById('nextBtn');
			const bigNumber = document.getElementById('bigNumber');

			// ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
			const monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
			monthNames.forEach((n, i) => {const o = document.createElement('option'); o.value = i + 1; o.textContent = n; monthSelect.appendChild(o);});
			const curY = new Date().getFullYear();
			for (let y = curY - 3; y <= curY + 1; y++) {const o = document.createElement('option'); o.value = y; o.textContent = y; yearSelect.appendChild(o);}

			// ë„ë„›ê³¼ ë™ì¼í•œ íŒ”ë ˆíŠ¸
			const COLOR_SELECTED = '#ff6b6b';
			const COLOR_DEFAULT = '#dbe4f3';

			// ë§‰ëŒ€ì°¨íŠ¸ìš©: ì„ íƒ ì›”ë§Œ ë¹¨ê°„ìƒ‰
			function barColors(selectedMonth) {
				return monthNames.map((_, i) =>
					i === (selectedMonth - 1) ? COLOR_SELECTED : COLOR_DEFAULT
				);
			}

			// ì¤‘ì•™ í…ìŠ¤íŠ¸ í”ŒëŸ¬ê·¸ì¸ (Chart.js v4)
			const centerTextPlugin = {
				id: 'centerText',
				beforeDraw(chart, args, opts) {
					if (!opts) return;
					const {ctx, chartArea: {left, right, top, bottom, width, height}} = chart;
					const x = left + width / 2;
					const y = top + height / 2;
					ctx.save();
					ctx.textAlign = 'center';
					ctx.textBaseline = 'middle';
					ctx.fillStyle = '#9aa2ad';
					ctx.font = '700 14px system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif';
					if (opts.line1) ctx.fillText(opts.line1, x, y - 12);
					ctx.fillStyle = '#ff6b6b';
					ctx.font = '900 22px system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif';
					if (opts.line2) ctx.fillText(opts.line2, x, y + 12);
					ctx.restore();
				}
			};

			// ë§‰ëŒ€ ì°¨íŠ¸
			const barChart = new Chart(document.getElementById('emissionChart'), {
				type: 'bar',
				data: {
					labels: monthNames,
					datasets: [{
						data: new Array(12).fill(0),
						backgroundColor: barColors(month),
						borderRadius: 8,
						borderSkipped: false
					}]
				},
				options: {
					responsive: true, maintainAspectRatio: false,
					plugins: {legend: {display: false}, tooltip: {callbacks: {label: c => `${c.raw.toLocaleString()} kg`}}},
					scales: {
						x: {grid: {display: false}, ticks: {font: {weight: '700'}}},
						y: {beginAtZero: true, grid: {borderDash: [6, 6]}, ticks: {callback: v => v.toLocaleString()}}
					}
				}
			});

			// ë„ë„› ì°¨íŠ¸
			const donutCtx = document.getElementById('emissionDonut');
			const donutChart = new Chart(donutCtx, {
				type: 'doughnut',
				data: {labels: monthNames, datasets: [{data: new Array(12).fill(0), borderWidth: 0, hoverOffset: 6, backgroundColor: []}]},
				options: {
					responsive: true, maintainAspectRatio: false, cutout: '65%',
					plugins: {
						legend: {position: 'bottom'},
						tooltip: {
							callbacks: {
								label: (c) => {
									const v = c.raw || 0;
									const total = (donutChart.data.datasets[0].data || []).reduce((a, b) => a + (b || 0), 0) || 1;
									const pct = (v * 100 / total).toFixed(1);
									return `${c.label}: ${v.toLocaleString()} kg (${pct}%)`;
								}
							}
						},
						centerText: {line1: '', line2: ''} // ë™ì ìœ¼ë¡œ ì±„ì›€
					}
				},
				plugins: [centerTextPlugin]
			});

			function setSelectors(y, m) {yearSelect.value = y; monthSelect.value = m;}

			// ì„ íƒ ì›” ê°•ì¡°ìƒ‰ ë°°ì—´
			function donutColors(selectedMonth) {
				return monthNames.map((_, i) => i === (selectedMonth - 1) ? '#ff6b6b' : '#dbe4f3');
			}

			// ì¶”ê°€: ì„ íƒ ì›” ë°”ë€” ë•Œ ë§‰ëŒ€ ìƒ‰ë§Œ ì—…ë°ì´íŠ¸
			function refreshBarVisuals() {
				barChart.data.datasets[0].backgroundColor = barColors(month);
				barChart.update();
			}

			// ë„ë„› ì¤‘ì•™ í…ìŠ¤íŠ¸/ìƒ‰ ì—…ë°ì´íŠ¸
			function refreshDonutVisuals() {
				const data = donutChart.data.datasets[0].data;
				const selKg = data[month - 1] || 0;
				donutChart.data.datasets[0].backgroundColor = donutColors(month);
				donutChart.options.plugins.centerText = {
					line1: `${month}ì›”`,
					line2: `${selKg.toLocaleString()} KG`
				};
				donutChart.update();
			}

			async function loadMonthly(y) {
				const r = await fetch(`/api/emission/monthly?user_Id=${uid}&year=${y}`);
				const arr = await r.json(); // [{month, kg}]
				const data = new Array(12).fill(0);
				arr.forEach(it => data[it.month - 1] = it.kg || 0);

				// ë§‰ëŒ€ ì°¨íŠ¸ ë°˜ì˜
				barChart.data.datasets[0].data = data;
				barChart.data.datasets[0].backgroundColor = barColors(month); //ì„¹ìƒ ì¶”ê°€
				barChart.update();

				// ë„ë„› ì°¨íŠ¸ ë°˜ì˜
				donutChart.data.datasets[0].data = data;
				refreshDonutVisuals();
				refreshBarVisuals();
			}

			async function loadSummary(y, m) {
				const r = await fetch(`/api/emission/summary?user_Id=${uid}&year=${y}&month=${m}`);
				const j = await r.json();
				bigNumber.textContent = `${(j.totalKg || 0).toLocaleString()} KG`;
			}

			function step(dir) {
				const d = new Date(year, month - 1, 1);
				d.setMonth(d.getMonth() + dir);
				year = d.getFullYear(); month = d.getMonth() + 1;
				setSelectors(year, month);
				loadSummary(year, month);
				loadMonthly(year);
			}

			monthSelect.addEventListener('change', () => {
				month = Number(monthSelect.value);
				loadSummary(year, month);
				refreshDonutVisuals(); // ì„ íƒ ì›”ë§Œ ë°”ë€ ê²½ìš° ìƒ‰/ì¤‘ì•™í…ìŠ¤íŠ¸ ê°±ì‹ 
				refreshBarVisuals(); //ë§‰ëŒ€ì°¨íŠ¸ë„!
			});

			yearSelect.addEventListener('change', () => {
				year = Number(yearSelect.value);
				loadMonthly(year);
				loadSummary(year, month);
			});

			prevBtn.addEventListener('click', () => step(-1));
			nextBtn.addEventListener('click', () => step(1));

			// ì´ˆê¸° ë¡œë”©
			setSelectors(year, month);
			loadMonthly(year);
			loadSummary(year, month);
		})();

	</script>

</body>

</html>